<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Viagens - F√©rias</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(to bottom, #87CEFA, #ffffff); color: #333; }
  header { text-align: center; padding: 40px 0; background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1350&q=80') no-repeat center; background-size: cover; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }
  header h1 { font-size: 2.5em; margin: 0; }
  table { width: 95%; border-collapse: collapse; margin: 20px auto; border-radius: 12px; overflow: hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.15); background-color: rgba(255,255,255,0.95); }
  th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ccc; }
  th.hospedagem, td.hospedagem { width: 180px; }
  th.allInclusive, td.allInclusive { width: 80px; text-align: center; }
  tr:hover { background-color: rgba(0, 128, 128, 0.1); }
  .mais-barato { background-color: #d4edda !important; }
  #resumo { margin-top: 15px; text-align: center; font-weight: bold; font-size: 1.2em; color: #2E8B57; }
  h2 { text-align: center; color: #2E8B57; }
  a { text-decoration: none; color: #fff; }
  input, select { padding: 8px; width: 90%; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; box-shadow: 1px 1px 4px rgba(0,0,0,0.1); }
  button { padding: 5px 10px; border: none; border-radius: 6px; cursor: pointer; background-color: #ff7f50; color: #fff; font-weight: bold; }
  button:hover { background-color: #ff6347; }
  form { width: 300px; margin: 20px auto; text-align: center; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
</head>
<body>

<header>
  <h1>‚úàÔ∏èüå¥üèñÔ∏è Sistema de Viagens - F√©rias üå¥‚úàÔ∏èüèñÔ∏è</h1>
</header>

<h2>Lista de Viagens</h2>
<table id="viagensTable">
<thead>
<tr>
  <th>Destino</th>
  <th class="hospedagem">Hospedagem</th>
  <th>Tipo</th>
  <th class="allInclusive">All Inclusive</th>
  <th>Valor do Hotel (R$)</th>
  <th>Valor da Passagem (R$)</th>
  <th>Pessoas</th>
  <th>Total Base (R$)</th>
  <th>M√™s</th>
  <th>Ano</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="resumo"></div>

<h2>Adicionar Viagem</h2>
<form id="viagemForm">
  <input type="text" id="destino" placeholder="Destino" required><br>
  <input type="text" id="hotel" placeholder="Nome da Hospedagem" required><br>
  <input type="url" id="linkHotel" placeholder="Link do Hotel (URL)" required><br>
  <select id="tipoHospedagem" required>
    <option value="Hotel">Hotel</option>
    <option value="Airbnb">Airbnb</option>
  </select><br>
  <select id="allInclusive" required>
    <option value="Sim">All Inclusive</option>
    <option value="N√£o">N√£o</option>
  </select><br>
  <input type="number" id="valorHotel" placeholder="Valor do Hotel" required><br>
  <input type="number" id="valorPassagem" placeholder="Valor da Passagem" required><br>
  <input type="number" id="pessoas" placeholder="Quantidade de Pessoas" min="1" required><br>
  <select id="mes" required>
    <option value="">Selecione o m√™s</option>
    <option value="Janeiro">Janeiro</option>
    <option value="Fevereiro">Fevereiro</option>
    <option value="Mar√ßo">Mar√ßo</option>
    <option value="Abril">Abril</option>
    <option value="Maio">Maio</option>
    <option value="Junho">Junho</option>
    <option value="Julho">Julho</option>
    <option value="Agosto">Agosto</option>
    <option value="Setembro">Setembro</option>
    <option value="Outubro">Outubro</option>
    <option value="Novembro">Novembro</option>
    <option value="Dezembro">Dezembro</option>
  </select><br>
  <input type="number" id="ano" placeholder="Ano da Viagem" required><br>
  <button type="submit">Salvar Viagem</button>
</form>

<script>
// Link p√∫blico da planilha (publicada na web)
const publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2HW4c2GZyc0l3g8j5Kx1Xj4fH3tM4O3NwUe1/pubhtml';

// Link do seu Apps Script
const webAppUrl = 'https://script.google.com/macros/s/AKfycbzCplWdT_uX0UJ13Y4sqzJyMWGf--tFa0Hgp-ToHjw/dev';

function init() {
  Tabletop.init({
    key: publicSpreadsheetUrl,
    callback: showViagens,
    simpleSheet: true
  });
}

function showViagens(data, tabletop) {
  const tableBody = document.querySelector('#viagensTable tbody');
  tableBody.innerHTML = '';

  if(!data || !data.length){
    document.getElementById('resumo').textContent = 'Nenhuma viagem cadastrada.';
    return;
  }

  data.forEach(v => v.totalBase = parseFloat(v.valorHotel) + parseFloat(v.valorPassagem));
  const menorTotal = Math.min(...data.map(v => v.totalBase));

  data.forEach(v => {
    const row = document.createElement('tr');
    if(v.totalBase === menorTotal) row.classList.add('mais-barato');

    const iconHospedagem = v.tipoHospedagem === "Hotel" ? "üè®" : "üè†";
    const iconAllInclusive = v.allInclusive === "Sim" ? "üçπ" : "‚ùå";

    row.innerHTML = `
      <td>üå¥ ${v.destino}</td>
      <td class="hospedagem"><button onclick="window.open('${v.linkHotel}','_blank')">${iconHospedagem} ${v.hotel}</button></td>
      <td>${v.tipoHospedagem}</td>
      <td class="allInclusive">${iconAllInclusive}</td>
      <td>R$ ${parseFloat(v.valorHotel).toFixed(2)}</td>
      <td>R$ ${parseFloat(v.valorPassagem).toFixed(2)}</td>
      <td>${v.pessoas}</td>
      <td>R$ ${v.totalBase.toFixed(2)}</td>
      <td>${v.mes}</td>
      <td>${v.ano}</td>
    `;
    tableBody.appendChild(row);
  });

  const destinosBaratos = data.filter(v => v.totalBase === menorTotal)
                              .map(v => `${v.destino} (R$ ${v.totalBase.toFixed(2)})`)
                              .join(', ');
  document.getElementById('resumo').textContent = `Destino(s) mais barato(s): ${destinosBaratos}`;
}

const form = document.getElementById('viagemForm');
form.addEventListener('submit', function(e){
  e.preventDefault();

  const dados = {
    destino: document.getElementById('destino').value,
    hotel: document.getElementById('hotel').value,
    linkHotel: document.getElementById('linkHotel').value,
    tipoHospedagem: document.getElementById('tipoHospedagem').value,
    allInclusive: document.getElementById('allInclusive').value,
    valorHotel: document.getElementById('valorHotel').value,
    valorPassagem: document.getElementById('valorPassagem').value,
    pessoas: document.getElementById('pessoas').value,
    mes: document.getElementById('mes').value,
    ano: document.getElementById('ano').value
  };

  fetch(webAppUrl, {
    method: "POST",
    body: JSON.stringify(dados)
  })
  .then(response => response.json())
  .then(res => {
    if(res.status === "success"){
      alert("Viagem adicionada com sucesso!");
      form.reset();
      init();
    }
  })
  .catch(err => alert("Erro ao enviar dados: "+err));
});

window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
